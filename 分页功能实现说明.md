# 分页功能实现说明

## 问题发现

原前端代码中，`LoadImagesAsync` 方法使用了硬编码的分页参数：
```csharp
var result = await imageApi.GetImages(1, 50);  // 固定第1页，每页50条
```

这导致用户无法切换页面，只能看到前50张图片。

---

## 解决方案

### 1. 后端支持（已有）✅

后端 `ImageController.GetImages` 方法已经支持分页：
```csharp
[HttpGet]
public async Task<ActionResult<PaginatedResult<ImageDto>>> GetImages(
    [FromQuery] PaginatedRequestDto request)
{
    // pageIndex, pageSize 参数
    // 返回 PaginatedResult<ImageDto> 包含：
    // - Items: 当前页数据
    // - TotalCount: 总数据量
    // - PageIndex: 当前页码
    // - PageSize: 每页数量
    // - TotalPages: 总页数（计算属性）
}
```

### 2. 前端 ViewModel 改进 ✅

#### 新增属性
```csharp
// 分页状态
private int _currentPage = 1;           // 当前页码
private int _pageSize = 12;             // 每页显示数量
private int _totalCount = 0;            // 总图片数
private int _totalPages = 0;            // 总页数
private bool _hasPreviousPage = false;  // 是否有上一页
private bool _hasNextPage = false;      // 是否有下一页

// 计算属性
public string PageInfo => $"第 {CurrentPage} / {TotalPages} 页 (共 {TotalCount} 张图片)";
public bool CanGoPrevious => HasPreviousPage;
public bool CanGoNext => HasNextPage;
```

#### 改进的 LoadImagesAsync 方法
```csharp
public async Task LoadImagesAsync()
{
    // 使用动态参数
    var result = await imageApi.GetImages(CurrentPage, PageSize);
    
    // 解析分页信息
    if (jsonRoot.TryGetProperty("totalCount", out var totalCountElement))
    {
        TotalCount = totalCountElement.GetInt32();
        TotalPages = (int)Math.Ceiling((double)TotalCount / PageSize);
        HasPreviousPage = CurrentPage > 1;
        HasNextPage = CurrentPage < TotalPages;
    }
    
    // 加载图片列表...
}
```

#### 新增命令
```csharp
// 上一页
[RelayCommand(CanExecute = nameof(CanGoPrevious))]
private async Task GoToPreviousPageAsync()
{
    if (CurrentPage > 1)
    {
        CurrentPage--;
        await LoadImagesAsync();
    }
}

// 下一页
[RelayCommand(CanExecute = nameof(CanGoNext))]
private async Task GoToNextPageAsync()
{
    if (CurrentPage < TotalPages)
    {
        CurrentPage++;
        await LoadImagesAsync();
    }
}

// 跳转到指定页
[RelayCommand]
private async Task GoToPageAsync(int pageNumber)
{
    if (pageNumber >= 1 && pageNumber <= TotalPages)
    {
        CurrentPage = pageNumber;
        await LoadImagesAsync();
    }
}
```

### 3. 前端 UI 改进 ✅

在 `DashboardView.xaml` 底部添加了分页控件：

```xml
<!-- 分页控件 -->
<materialDesign:Card Grid.Row="2" Padding="15" Margin="0,10,0,0">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- 上一页按钮 -->
        <Button Grid.Column="0"
                Command="{Binding GoToPreviousPageCommand}"
                ...>
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="ChevronLeft"/>
                <TextBlock Text="上一页"/>
            </StackPanel>
        </Button>

        <!-- 页码信息 + 每页数量选择 -->
        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
            <TextBlock Text="{Binding PageInfo}"/>
            <TextBlock Text="每页显示:"/>
            <ComboBox SelectedItem="{Binding PageSize}">
                <ComboBoxItem Content="6"/>
                <ComboBoxItem Content="12" IsSelected="True"/>
                <ComboBoxItem Content="24"/>
                <ComboBoxItem Content="48"/>
            </ComboBox>
        </StackPanel>

        <!-- 下一页按钮 -->
        <Button Grid.Column="2"
                Command="{Binding GoToNextPageCommand}"
                ...>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="下一页"/>
                <materialDesign:PackIcon Kind="ChevronRight"/>
            </StackPanel>
        </Button>
    </Grid>
</materialDesign:Card>
```

---

## 功能特性

### ✅ 已实现
1. **动态分页**：根据 `CurrentPage` 和 `PageSize` 加载数据
2. **页码显示**：显示"第 X / Y 页 (共 Z 张图片)"
3. **上一页/下一页按钮**：自动禁用不可用的按钮
4. **每页数量选择**：支持 6/12/24/48 张图片
5. **自动刷新**：切换页码或每页数量时自动重新加载

### 🎨 UI 特点
- Material Design 风格
- 按钮自动禁用（第一页禁用"上一页"，最后一页禁用"下一页"）
- 实时显示分页信息
- 支持自定义每页显示数量

---

## 使用方式

### 用户操作
1. 点击"刷新"按钮加载第一页图片
2. 使用"上一页"/"下一页"按钮切换页面
3. 在下拉框中选择每页显示数量（会自动重新加载）
4. 查看页码信息了解当前位置

### 开发者扩展
如果需要添加"跳转到指定页"功能：
```xml
<TextBox Width="50" Text="{Binding JumpToPage, UpdateSourceTrigger=PropertyChanged}"/>
<Button Command="{Binding GoToPageCommand}" CommandParameter="{Binding JumpToPage}">
    跳转
</Button>
```

---

## 测试建议

1. **上传大量图片**（超过12张）测试分页
2. **切换每页数量**，验证是否正确重新加载
3. **测试边界情况**：
   - 只有1页时，上一页/下一页按钮应该都禁用
   - 在最后一页时，下一页按钮应该禁用
   - 在第一页时，上一页按钮应该禁用

---

## 总结

✅ **分页功能现已完整实现**，满足实验要求中的"获取图像并展示"功能。

用户可以：
- 浏览所有图片（分页显示）
- 自由切换页面
- 自定义每页显示数量
- 实时查看分页状态
