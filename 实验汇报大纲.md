# UIPS 水下图像处理系统 - 实验汇报

## 一、项目概述（1-2分钟）

### 项目名称
UIPS - Underwater Image Processing System（水下图像处理系统）

### 项目定位
一个基于 .NET 技术栈的全栈图片管理系统，采用前后端分离架构。

### 技术选型
| 层级 | 技术 |
|------|------|
| 后端框架 | ASP.NET Core 8 Web API |
| 前端框架 | WPF + Material Design |
| 数据库 | SQLite + Entity Framework Core |
| 认证方案 | JWT Token + BCrypt 密码加密 |
| 架构模式 | MVVM（前端）+ RESTful API（后端）|

---

## 二、功能演示（3-5分钟）

### 2.1 用户认证模块
- **注册功能**：用户名 + 密码注册，密码 BCrypt 加密存储
- **登录功能**：验证成功后返回 JWT Token
- **角色区分**：普通用户 / 管理员

### 2.2 图片管理模块（核心功能）
- **单文件上传**：选择文件 → 上传 → 存储到服务器
- **批量上传**：支持多选文件同时上传
- **图片浏览**：分页显示、按文件名筛选
- **图片预览**：点击图片全屏预览
- **收藏功能**：点击爱心标记/取消收藏
- **删除功能**：管理员可删除任意图片

### 2.3 管理员模块
- **数据统计**：总用户数、管理员数、图片数、收藏数
- **用户管理**：查看用户列表、重置密码、删除用户
- **分页浏览**：支持分页查看用户列表

---

## 三、技术亮点（3-4分钟）

### 3.1 JWT 认证机制
```
用户登录 → 服务端验证 → 生成 JWT Token → 客户端存储
后续请求 → 携带 Token → 服务端验证 → 返回数据
```

**关键代码**（AuthController.cs）：
- 使用 `JwtSecurityTokenHandler` 生成 Token
- Token 包含 UserId、UserName、Role 等 Claims
- 设置 Token 过期时间

### 3.2 MVVM 架构实践
```
View (XAML) ←→ ViewModel (C#) ←→ Model/Service
     ↑              ↑
   数据绑定      命令绑定
```

**使用的技术**：
- `CommunityToolkit.Mvvm`：简化 MVVM 实现
- `[ObservableProperty]`：自动生成属性通知
- `[RelayCommand]`：自动生成命令

### 3.3 Refit 实现 API 调用
```csharp
public interface IImageApi
{
    [Post("/api/images/upload")]
    Task<dynamic> UploadImage([AliasAs("file")] StreamPart file);
    
    [Get("/api/images")]
    Task<dynamic> GetImages([Query] int pageIndex, [Query] int pageSize);
}
```
- 声明式 API 定义，无需手写 HttpClient 代码
- 自动处理序列化/反序列化

### 3.4 Entity Framework Core
- Code First 模式：先定义实体类，自动生成数据库
- 导航属性：User → Images、User → Favourites
- LINQ 查询：类型安全的数据库操作

---

## 四、项目结构（1-2分钟）

```
UIPS/
├── src/
│   ├── UIPS.API/                 # 后端 Web API
│   │   ├── Controllers/          # 控制器（Auth、Image、Admin）
│   │   ├── Models/               # 数据模型（User、Image、Favourite）
│   │   ├── DTOs/                 # 数据传输对象
│   │   ├── Services/             # 业务服务（文件存储）
│   │   └── Program.cs            # 启动配置
│   │
│   └── UIPS.Client/              # 前端 WPF 客户端
│       ├── Views/                # 视图（XAML）
│       ├── ViewModels/           # 视图模型
│       ├── Services/             # API 接口定义
│       ├── Converters/           # 值转换器
│       └── Resources/            # 样式资源
│
└── tests/                        # 单元测试
```

---

## 五、遇到的问题与解决（2-3分钟）

### 问题1：WPF 控件初始化时机
**现象**：构造函数中访问 XAML 控件报 NullReferenceException  
**原因**：InitializeComponent() 之前控件未创建  
**解决**：使用 `Loaded` 事件延迟初始化

### 问题2：分页按钮无法点击
**现象**：上一页/下一页按钮始终禁用  
**原因**：CanExecute 状态没有随属性变化更新  
**解决**：添加 `[NotifyCanExecuteChangedFor]` 特性

### 问题3：图片显示需要认证
**现象**：img 标签无法直接显示需要认证的图片  
**解决**：URL 中携带 access_token 参数，后端支持 Query 参数认证

---

## 六、项目收获（1分钟）

1. **全栈开发能力**：从后端 API 到前端 UI 的完整开发流程
2. **架构设计思维**：MVVM 模式、前后端分离、RESTful API 设计
3. **.NET 生态实践**：EF Core、ASP.NET Core、WPF 的综合运用
4. **安全意识**：JWT 认证、密码加密、权限控制

---

## 七、可改进方向

- Token 过期自动刷新
- 图片缩略图生成
- 批量操作功能
- 响应式布局优化

---

## 演示顺序建议

1. 启动后端 API（展示 Swagger 文档）
2. 启动前端客户端
3. 演示注册 → 登录流程
4. 演示图片上传（单个 + 批量）
5. 演示图片浏览、分页、预览
6. 演示收藏功能
7. 切换管理员账号，演示管理功能
8. 简要展示关键代码
